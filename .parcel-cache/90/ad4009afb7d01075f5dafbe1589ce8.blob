var _baseComponent = require("../baseComponent");
var _parcelHelpers = require("@parcel/transformer-js/lib/esmodule-helpers.js");
var _baseComponentDefault = _parcelHelpers.interopDefault(_baseComponent);
var _modelAndControler = require("../modelAndControler");
var _modelAndControlerDefault = _parcelHelpers.interopDefault(_modelAndControler);
class DodajOglas extends _baseComponentDefault.default {
  constructor() {
    super("div");
    let button = document.createElement("a");
    button.className = "btn modal-trigger col s12 waves-effect waves-light btn";
    button.href = "#modal1";
    // otvara modal1 iz html tj. obrazac za novi oglas
    button.innerHTML = "Dodaj oglas";
    document.getElementById("dodajOglas").addEventListener("click", () => {
      this.dodajOglas();
    });
    this.addChild(button);
  }
  dodajOglas() {
    let opis = document.getElementById("opis");
    let cijena = document.getElementById("cijena");
    let type = document.getElementById("predmet");
    let razina = document.getElementById("razina");
    // prikuplja podatke iz modal1
    let user = JSON.parse(localStorage["user"]);
    let database = firebase.firestore();
    database.collection("korisnici").where("username", "==", user.username).get().then(function (querySnapshot) {
      querySnapshot.forEach(function (doc) {
        let korisnik = doc.data();
        let id = Number();
        // id za oglas
        if (korisnik.oglasi.length == false) {
          id = 0;
        } else {
          let obj = korisnik.oglasi[korisnik.oglasi.length - 1];
          // trazi posljednje uneseni oglas
          id = obj.id + 1;
        }
        let noviOglas = {
          cijena: cijena.value,
          id: id,
          ocjena: {
            like: [],
            dislike: []
          },
          opis: opis.value,
          predmet: type.value,
          razina: razina.value
        };
        korisnik.oglasi.push(noviOglas);
        // trenutni niz oglasa push prima novonapravljeni oglas
        database.collection("korisnici").doc(doc.id).update({
          // update
          oglasi: korisnik.oglasi
        });
        let tempNiz = noviOglas;
        // U njemu se nalaze svi podaci koji su portrebni da bi novi oglasi preko addEventListenera napravili novu kartivu
        tempNiz["kontakt"] = korisnik.kontakt;
        tempNiz["username"] = korisnik.username;
        tempNiz["lokacija"] = korisnik.lokacija;
        _modelAndControlerDefault.default.addOglas(tempNiz);
      });
      opis.value = "";
      cijena.value = "";
      type.value = "matematika";
      razina.value = "osnovna Å¡kola";
    });
  }
}
module.exports = DodajOglas;
