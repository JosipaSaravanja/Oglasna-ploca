var _baseComponent = require("../baseComponent");
var _parcelHelpers = require("@parcel/transformer-js/lib/esmodule-helpers.js");
var _baseComponentDefault = _parcelHelpers.interopDefault(_baseComponent);
var _oglasTodoCard = require("./oglasTodoCard");
var _oglasTodoCardDefault = _parcelHelpers.interopDefault(_oglasTodoCard);
var _modelAndControler = require("../modelAndControler");
var _modelAndControlerDefault = _parcelHelpers.interopDefault(_modelAndControler);
class MojiOglasi extends _baseComponentDefault.default {
  constructor() {
    super("div");
    this.spremljeniOglasi = document.createElement("div");
    this.noviOglasi = document.createElement("div");
    let database = firebase.firestore();
    database.collection("korisnici").where("username", "==", _modelAndControlerDefault.default.user.username).get().then(querySnapshot => {
      querySnapshot.forEach(doc => {
        let korisnik = doc.data();
        korisnik.oglasi.reverse().forEach(el => {
          // pronalazi sve oglase korisnika i ispisuje ih od kraja tako da su oni nedavno uneseni na vrhu
          let oglas = new _oglasTodoCardDefault.default(el.id, korisnik.kontakt, el.opis, korisnik.lokacija, el.cijena, el.predmet, el.razina, el.date, el.ocjena.like, el.ocjena.dislike, korisnik.username);
          this.spremljeniOglasi.appendChild(oglas.rootElement);
        });
      });
    });
    _modelAndControlerDefault.default.addEventListener("newOglas", event => {
      this.dodanJeOglas(event.detail.oglas);
    });
    this.addChildren([this.noviOglasi, this.spremljeniOglasi]);
  }
  dodanJeOglas(el) {
    console.log(el);
    let oglas = new _oglasTodoCardDefault.default(el.id, el.kontakt, el.opis, el.lokacija, el.cijena, el.predmet, el.razina, el.date, el.ocjena.like, el.ocjena.dislike, el.username);
    this.noviOglasi.insertBefore(oglas.rootElement, this.noviOglasi.firstChild);
    this.noviOglasi.appendChild(oglas.rootElement);
  }
}
module.exports = MojiOglasi;
