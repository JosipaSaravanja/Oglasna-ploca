var _baseComponent = require("../baseComponent");
var _parcelHelpers = require("@parcel/transformer-js/lib/esmodule-helpers.js");
var _baseComponentDefault = _parcelHelpers.interopDefault(_baseComponent);
var _spremljeniOglasi = require("./spremljeniOglasi");
var _spremljeniOglasiDefault = _parcelHelpers.interopDefault(_spremljeniOglasi);
var _dodajOglas = require("./dodajOglas");
var _dodajOglasDefault = _parcelHelpers.interopDefault(_dodajOglas);
require("../modelAndControler");
require("./mojOglas");
var _noviOglas = require("./noviOglas");
var _noviOglasDefault = _parcelHelpers.interopDefault(_noviOglas);
let controler = new Controler();
class TreciStupac extends _baseComponentDefault.default {
  constructor() {
    super("div");
    let sadrzaj = document.createElement("div");
    let user = JSON.parse(localStorage["user"]);
    if (user == false) {
      sadrzaj.innerHTML = "";
    } else {
      let spremljeniOglasi = new _spremljeniOglasiDefault.default();
      let dodajOglas = new _dodajOglasDefault.default();
      let noviOglas = new _noviOglasDefault.default();
      this.addChildren([dodajOglas.rootElement, spremljeniOglasi.rootElement, noviOglas.rootElement]);
    }
  }
  dodajOglas() {
    let grad = document.getElementById("grad");
    let zupanija = document.getElementById("zupanije");
    let opis = document.getElementById("opis");
    let cijena = document.getElementById("cijena");
    let type = document.getElementById("predmet");
    let razina = document.getElementById("razina");
    let user = JSON.parse(localStorage["user"]);
    let database = firebase.firestore();
    database.collection("korisnici").where("username", "==", user.username).get().then(function (querySnapshot) {
      querySnapshot.forEach(function (doc) {
        let korisnik = doc.data();
        let id = Number();
        if (korisnik.oglasi.length == false) {
          id = 0;
        } else {
          let obj = korisnik.oglasi[korisnik.oglasi.length - 1];
          id = obj.id + 1;
        }
        let noviOglas = {
          cijena: cijena.value,
          id: id,
          lokacija: {
            grad: grad.value,
            Å¾upanija: zupanija.value
          },
          ocjena: {
            like: Number(0),
            dislike: Number(0)
          },
          opis: opis.value,
          predmet: type.value,
          razina: razina.value
        };
        let niz = korisnik.oglasi;
        niz.push(noviOglas);
        database.collection("korisnici").doc(doc.id).update({
          oglasi: niz
        });
      });
    });
  }
}
module.exports = TreciStupac;
